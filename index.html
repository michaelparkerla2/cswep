<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSWEP – Crypto Dust Sweeper</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { background: #0e0e0e; color: white; font-family: 'Segoe UI', sans-serif; display: flex; margin:0; padding:0;}
    .main {margin:auto; padding:20px; max-width:600px; text-align:center;}
    button { padding:10px 20px; margin:10px; background:#0a65ff; color:white; border:none; border-radius:8px; cursor:pointer; }
    button:hover {background:#084dc1;}
    table {width:100%;margin-top:20px;border-collapse:collapse;}
    th, td {border-bottom:1px solid #333;padding:10px;text-align:left;}
    th {background:#1e1e1e;color:#0a65ff;}
    .disabled {opacity:0.6;color:#666;}
  </style>
</head>
<body>
  <div class="main">
    <h1>CSWEP – Crypto Dust Sweeper (BETA)</h1>
    <button onclick="connectWallet()">Connect Wallet</button>
    <div id="walletAddress"></div>
    <table id="balancesTable">
      <thead><tr><th>Token</th><th>Balance</th></tr></thead>
      <tbody></tbody>
    </table>
    <button onclick="simulateSweep()">Sweep Dust (Simulated)</button>
  </div>

  <script>
    let provider, signer, userAddress;

    const tokens = [
      { name: 'ETH', symbol: 'ETH', decimals: 18 },
      { name: 'USDT', symbol: 'USDT', address: '0xdAC17F958D2ee523a2206206994597C13D831ec7', decimals: 6 },
      { name: 'USDC', symbol: 'USDC', address: '0xA0b86991C6218B36c1D19D4a2e9Eb0cE3606eB48', decimals: 6 },
      { name: 'DAI', symbol: 'DAI', address: '0x6B175474E89094C44Da98b954EedeAC495271d0F', decimals: 18 },
      { name: 'SHIBA', symbol: 'SHIBA', address: '0x95aD61b0a150d79219dCF64E1E6Cc01f0B64C4cE', decimals: 18 },
      { name: 'MATIC', symbol: 'MATIC', address: '0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0', decimals: 18 },
      { name: 'LINK', symbol: 'LINK', address: '0x514910771AF9Ca656af840dff83E8264EcF986CA', decimals: 18 }
    ];

    async function connectWallet(){
      if(window.ethereum){
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts",[]);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        document.getElementById('walletAddress').innerText="Wallet connected: "+userAddress;
        fetchBalances();
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function fetchBalances(){
      const tableBody = document.querySelector("#balancesTable tbody");
      tableBody.innerHTML = '';
      
      const ethBal = await provider.getBalance(userAddress);
      const ethBalance = parseFloat(ethers.utils.formatEther(ethBal));
      if(ethBalance < 0.01) addBalanceRow('ETH', ethBalance);

      const erc20Abi=["function balanceOf(address) view returns (uint256)"];
      for(let token of tokens.slice(1)){
        const contract = new ethers.Contract(token.address,erc20Abi,provider);
        const rawBalance = await contract.balanceOf(userAddress);
        const balance = parseFloat(ethers.utils.formatUnits(rawBalance,token.decimals));
        if(balance < 1 && balance > 0) addBalanceRow(token.symbol, balance);
      }
    }

    function addBalanceRow(tokenSymbol, balance){
      const row=document.createElement('tr');
      row.innerHTML=`<td>${tokenSymbol}</td><td>${balance.toFixed(6)}</td>`;
      document.querySelector("#balancesTable tbody").appendChild(row);
    }

    function simulateSweep(){
      const rows=document.querySelectorAll("#balancesTable tbody tr");
      if(rows.length===0){ alert("No dust detected to sweep!"); return; }

      let sweptTokens=[];
      rows.forEach(row=>sweptTokens.push(row.cells[0].textContent));

      alert(`✨ Sweeping dust from: ${sweptTokens.join(", ")}.\n\n✅ Success!\n\nBETA MODE: No real balances moved yet. Thank you for testing CSWEP!`);
    }
  </script>
</body>
</html>
