<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSWEP Token Presale Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #0f0f0f;
        color: white;
        padding: 2rem;
      }
      .container {
        max-width: 600px;
        margin: auto;
        background-color: #1c1c1c;
        padding: 2rem;
        border-radius: 1rem;
      }
      button {
        background: #04d9ff;
        color: black;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 1rem;
      }
      .token-list {
        margin-top: 1rem;
      }
      .progress {
        height: 20px;
        width: 100%;
        background-color: #333;
        border-radius: 10px;
        margin-top: 1rem;
        overflow: hidden;
      }
      .progress-inner {
        height: 100%;
        background: #04d9ff;
        width: 0%;
        transition: width 0.5s;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>CSWEP Presale Dashboard</h1>
      <p>Connect wallet to view your balance and contribute to the presale.</p>

      <button id="connectBtn">üîó Connect Wallet</button>
      <div id="walletAddress"></div>

      <div class="token-list" id="tokenList"></div>

      <button id="sweepBtn">‚ú® Sweep My Crumbs</button>
      <div id="sweepEstimate"></div>

      <h3>Presale Contribution</h3>
      <button id="contributeETHBtn">üí∞ Contribute ETH</button>
      <button id="contributeUSDTBtn">üí∏ Contribute USDT</button>

      <div class="progress">
        <div class="progress-inner" id="progressBar"></div>
      </div>
      <p id="progressText">0 / 100 ETH raised</p>

      <div id="ownerControls" style="display:none">
        <h3>Owner Controls</h3>
        <button id="withdrawBtn">‚¨ÜÔ∏è Withdraw Funds</button>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script>
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      let userAddress = "";

      const tokens = [
        { symbol: "ETH", address: "", decimals: 18 },
        { symbol: "AAVE", address: "0x...", decimals: 18 },
        { symbol: "COMP", address: "0x...", decimals: 18 },
        { symbol: "GRT", address: "0x...", decimals: 18 },
        // Add up to 25 tokens here
      ];

      async function connectWallet() {
        await provider.send("eth_requestAccounts", []);
        userAddress = await signer.getAddress();
        document.getElementById("walletAddress").textContent = `Connected: ${userAddress}`;

        if (userAddress.toLowerCase() === "0x0b782aa2f054cf6c642467fdf8fd01e36ffc6221") {
          document.getElementById("ownerControls").style.display = "block";
        }

        fetchBalances();
        updatePresaleProgress();
      }

      async function fetchBalances() {
        let html = "<h4>Token Balances</h4><ul>";
        for (let token of tokens) {
          let balance;
          if (token.symbol === "ETH") {
            balance = await provider.getBalance(userAddress);
            balance = ethers.utils.formatEther(balance);
          } else {
            const erc20 = new ethers.Contract(token.address, ["function balanceOf(address) view returns (uint256)", "function decimals() view returns (uint8)"], provider);
            balance = await erc20.balanceOf(userAddress);
            balance = ethers.utils.formatUnits(balance, token.decimals);
          }
          html += `<li>${token.symbol}: ${parseFloat(balance).toFixed(4)}</li>`;
        }
        html += "</ul>";
        document.getElementById("tokenList").innerHTML = html;
      }

      async function sweepMyCrumbs() {
        Toastify({
          text: "üßπ Sweeping crumbs... value estimation in dev!",
          duration: 3000,
          gravity: "top",
          backgroundColor: "#04d9ff",
        }).showToast();
      }

      async function contributeETH() {
        const tx = await signer.sendTransaction({
          to: "YOUR_PRESALE_CONTRACT_ADDRESS",
          value: ethers.utils.parseEther("0.1"),
        });
        await tx.wait();
        Toastify({ text: "‚úÖ ETH Contribution Received!", duration: 3000 }).showToast();
        updatePresaleProgress();
      }

      async function contributeUSDT() {
        Toastify({ text: "‚öôÔ∏è USDT support coming soon...", duration: 3000 }).showToast();
      }

      async function updatePresaleProgress() {
        // placeholder simulation logic
        const ethRaised = 17.42; // replace with contract read
        const percent = (ethRaised / 100) * 100;
        document.getElementById("progressBar").style.width = `${percent}%`;
        document.getElementById("progressText").innerText = `${ethRaised.toFixed(2)} / 100 ETH raised`;
      }

      async function withdrawFunds() {
        Toastify({ text: "‚¨ÜÔ∏è Withdraw triggered (simulated)", duration: 3000 }).showToast();
      }

      document.getElementById("connectBtn").onclick = connectWallet;
      document.getElementById("sweepBtn").onclick = sweepMyCrumbs;
      document.getElementById("contributeETHBtn").onclick = contributeETH;
      document.getElementById("contributeUSDTBtn").onclick = contributeUSDT;
      document.getElementById("withdrawBtn").onclick = withdrawFunds;
    </script>
  </body>
</html>
